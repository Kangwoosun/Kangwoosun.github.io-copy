---
title: SAMSUNG CTF 2018 - catch_the_bug
categories:
 - pwnable
tags: arbitrary_write, exit, free_hook, pwn
---

- Intruction
- Vunlnerability
- Exploit
- slv.py
- 느낀 점
- Reference

## Intruction

언제부터였는지는 모르겠지만 CTF 동향이 malloc을 사용하는 문제에서 malloc을 직접적으로 사용하지 않고 다른 함수 내부에서 사용하는 것을 이용하는것을 봤는데..

이 문제가 그런 유형의 문제중에 하나였다. 되게 내부 루틴에서 malloc사용해서 지지고 볶고 해서 쉘따는거..

지금 환경이 환경인지라.. 결과적으로는 익스를 성공하진 못했다.

glibc 버전 차이 때문에 one_gadget이 맞질 않는것으로 잠정적 결론을 지었다.

aws cloud9이랑 구름ide 두개를 사용해서 문제를 풀고 있는데 문제의 환경은 glibc-2.26인데 aws는 2.27, ide는 2.19를 사용하고 있다.

진짜 해당 바이너리에 다른 libc 버전을 적용하려고 한 일주일 넘게 찾아봤는데 다 되질 않았다.

cloud 서비스 자체가 docker형식이라 그런것같은데... 정확한 원인은 모르겠지만 libc 버전을 바꾸는 순간 쉘 명령어들이 작동이 안됬다.. ls, cat, vim 같은것들이..;;

해당 부분은 이미 포기해서 일단 one_gadget이 실행되는 부분까지는 진행을 했다.

이 점을 염두해두고 글을 읽어주길 바란다. ^_^


## Vunlnerability

```
 ██████╗ █████╗ ███████╗ ██████╗██╗  ██╗
██╔════╝██╔══██╗╚═██╔══╝██╔════╝██║  ██║
██║     ███████║  ██║   ██║     ███████║
██║     ██╔══██║  ██║   ██║     ██╔══██║
╚██████╗██║  ██║  ██║   ╚██████╗██║  ██║
 ╚═════╝╚═╝  ╚═╝  ╚═╝    ╚═════╝╚═╝  ╚═╝
███████╗██╗  ██╗███████╗
╚═██╔══╝██║  ██║██╔════╝
  ██║   ███████║███████╗
  ██║   ██╔══██║██╔════╝
  ██║   ██║  ██║███████╗
  ╚═╝   ╚═╝  ╚═╝╚══════╝
██████╗ ██╗  ██╗ █████╗
██╔══██╗██║  ██║██╔═══╝
██████╔╝██║  ██║██║ ███╗
██╔══██╗██║  ██║██║  ██║
██████╔╝╚█████╔╝╚█████╔╝
╚═════╝  ╚════╝  ╚════╝

------------------------
-     Program Menu     -
------------------------
- 1. Catch a bug       -
- 2. Inspect the bug   -
- 3. Submit a repport  -
- 0. Exit              -
------------------------
>>
```

바이너리를 실행하면 이렇게 나오는데 취약점은 3번에서 발생된다.

1번에서 벌레를 3마리까지 잡을 수 있는데 해당 벌레의 string을 3번에서 전역변수에 `strcpy`로 복사를 해버린다.

여기서 전역변수에 overflow가 일어나고 그 뒤에 있던 pointer를 input으로 덮을 수 있게 되면서 tag와 password를 입력하는 부분에서 원하는 곳에 원하는 값을 2번 쓸 수 있다.

2번에서 FSB를 이용해서 leak이 가능하다.(벌레 이름을 '%p'로 하면 됨)


## Exploit




## slv.py

## 느낀 점

## Reference










